<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rastreio | Entrega em Tempo Real</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
      :root { --primary: #ff4500; --dark: #000000; }
      body { margin: 0; font-family: "Segoe UI", sans-serif; background: #f8fafc; display: flex; flex-direction: column; height: 100vh; }
      .header { background: var(--dark); padding: 15px; text-align: center; color: white; border-bottom: 2px solid var(--primary); }
      .code-box { background: var(--primary); color: white; padding: 20px; margin: 15px; border-radius: 15px; text-align: center; z-index: 10; }
      .code-value { font-size: 45px; font-weight: 900; letter-spacing: 5px; display: block; }
      #map { flex: 1; width: 100%; z-index: 1; }
    </style>
  </head>
  <body>
    <div class="header">
      <div id="store-name" style="font-weight: 900; letter-spacing: 1px">Carregando...</div>
      <div style="font-size: 11px">Sua entrega em tempo real</div>
    </div>

    <div id="map"></div>

    <div class="code-box">
        <span style="font-size: 11px; text-transform: uppercase">Código de Segurança</span>
        <span id="secret-code" class="code-value">----</span>
        <span style="font-size: 11px">Diga ao motoboy quando ele chegar.</span>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const orderId = urlParams.get("id");
      const storeSlug = urlParams.get("store") || "igo-iphones";
      const API_URL = "https://logistica-igo.onrender.com";

      const socket = io(API_URL);
      const map = L.map("map", { zoomControl: false }).setView([-8.0592, -34.8996], 13);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

      // Ajuste de cor por loja
      if(storeSlug === 'oxeiphone') {
          document.documentElement.style.setProperty('--primary', '#22c55e');
          document.getElementById('store-name').innerText = 'Oxe iPhone';
      } else {
          document.getElementById('store-name').innerText = 'iGo iPhones';
      }

      socket.emit("join_store", storeSlug);
      
      // Aqui você adicionaria a lógica de receber a localização do motoboy via socket
    </script>
  </body>
</html>
